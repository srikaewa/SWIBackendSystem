<!DOCTYPE html>
<html lang="en">
<head>
<title>SUT Smart Irrigation System Backend</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="/_css/bootstrap.min.css" />
<link rel="stylesheet" href="/_css/bootstrap-responsive.min.css" />
<link rel="stylesheet" href="/_css/fullcalendar.css" />
<link rel="stylesheet" href="/_css/matrix-style.css" />
<link rel="stylesheet" href="/_css/matrix-media.css" />
<link href="/_font-awesome/css/font-awesome.css" rel="stylesheet" />
<link rel="stylesheet" href="/_css/jquery.gritter.css" />
<link rel="stylesheet" href="/_css/custom.css" />
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>
<!--link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"-->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css" integrity="sha384-O8whS3fhG2OnA5Kas0Y9l3cfpmYjapjI0E4theH4iuMD+pLhbf6JI0jIMfYcK3yZ" crossorigin="anonymous">
<!--script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script-->
<script src="/_js/jquery.min.js"></script>
<script src="/_js/moment.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.0.4/firebase.js"></script>
<script>
  // Initialize Firebase
  //var config = require('firebase_config');
  //firebase.initializeApp(JSON.parse('<%- JSON.stringify(firebase_config) %>'));
  var config = {
    apiKey: "AIzaSyB9zKuiyZo-L0STWG86VXB4cVuPMKeWp2Y",
    authDomain: "swi-high-precision-farm.firebaseapp.com",
    databaseURL: "https://swi-high-precision-farm.firebaseio.com",
    projectId: "swi-high-precision-farm",
    storageBucket: "",
    messagingSenderId: "141388591700"
  };
  firebase.initializeApp(config);
</script>

<script>
var ApplicationUserManaged = (function () {
    function ApplicationUserManaged() { }
    ApplicationUserManaged.prototype.UserSignOutOption = function () {
        firebase.auth().signOut();
        setTimeout(function () {
            location.replace("login");
        }, 1000);
    }
    return ApplicationUserManaged;
} ());
var UserAccount = new ApplicationUserManaged();
</script>

</head>
<body>
  <script>
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          // User is signed in.
          var displayName = user.displayName;
          var email = user.email;
          var emailVerified = user.emailVerified;
          var photoURL = user.photoURL;
          var uid = user.uid;
          var phoneNumber = user.phoneNumber;
          var providerData = user.providerData;
          user.getIdToken().then(function(accessToken) {
            document.getElementById('user-email').textContent = email;
            document.getElementById('sign-in').textContent = 'Sign out';
            /*document.getElementById('account-details').textContent = JSON.stringify({
              displayName: displayName,
              email: email,
              emailVerified: emailVerified,
              phoneNumber: phoneNumber,
              photoURL: photoURL,
              uid: uid,
              accessToken: accessToken,
              providerData: providerData
            }, null, '  '); */
          });
          //post2user('user/update/'+uid+'/'+email+'/'+displayName, {});
        } else {
          // User is signed out.
          //document.getElementById('sign-in-status').textContent = 'Signed out';
          //document.getElementById('sign-in').textContent = 'Sign in';
          //document.getElementById('account-details').textContent = 'null';
          window.location = 'login';
        }
      }, function(error) {
        console.log(error);
      });
  </script>
  <script>
    $(document).ready(function(){
      //create firebase database reference
      var dbRef = firebase.database();
      var farmRef = dbRef.ref('/farm');

      farmRef.once('value').then(function(snapshot){
        snapshot.forEach(function(childSnapshot){
          var farm = childSnapshot.val();
          farm.id = childSnapshot.key;
          //console.log("before udpate dashboard...", farm.id);
          setInterval(function(){
            //console.log("start update dashboard...", farm.id);
            var hlc, hlr, rlc, rlr;
            if(farm.watering_scheme == "1")
            {
              hlc = moment(farm.humidity_last_checked);
              //hlr = moment(farm.humidity_last_read);  
              $('#farm-' + farm.id + '-humidity_last_checked').text(hlc.fromNow());
              //$('#farm-' + farm.id + '-humidity_last_read').text(hlr.fromNow());
            }else if(farm.watering_scheme == "2")
            {
              rlc = moment(farm.rain_last_checked);
              //rlr = moment(farm.rain_last_read);
              $('#farm-' + farm.id + '-rain_last_checked').text(rlc.fromNow());
              //$('#farm-' + farm.id + '-rain_last_read').text(rlc.fromNow());
            }              
            var laa = moment(farm.last_activated_at);                                  
            var lu = moment(farm.last_updated);          
            $('#farm-' + farm.id + '-last_activated_at').text(laa.fromNow());            
            $('#farm-' + farm.id + '-last_updated').text(lu.fromNow());
          }, 60000);
        })      
      // update from now every minute
      });

      farmRef.on("child_changed", function(snapshot) {
        //console.log("Farm id ==> ", snapshot.key);
        snapshot.forEach(function(childSnapshot) {
          switch(childSnapshot.key)
          {
            case "activated":
                /*if(childSnapshot.val() == "false") 
                  {            
                    var span_txt;
                    span_txt = 'button#button-farm-' + snapshot.key + '-activate';            
                    $(span_txt).removeClass("btn-success");
                    $(span_txt).addClass("btn-danger");
                    $(span_txt).html('<span class="icon-remove"></span> ปิด');                    
                    //console.log("Farm deactivated!!");
                  }
                else if(childSnapshot.val() == "true")
                  {
                    var span_txt;
                    span_txt = 'button#button-farm-' + snapshot.key + '-activate';
                    $(span_txt).removeClass("btn-danger");
                    $(span_txt).addClass("btn-success");
                    $(span_txt).html('<span class="icon-ok"></span> เปิด');
                    window.location.reload();
                    //console.log("Farm activated!!");
                  }*/
            case "humidity_critical_point":
            case "humidity_last_read":
            case "rain_last_read":
            case "farm_last_checked":
                window.location.reload();
                break;            
            /*case "last_activated_at":   
                var laa = moment(childSnapshot.val());
                $('#farm-' + snapshot.key + '-last_activated_at').text(laa.fromNow());
                break;            
            case "rain_last_checked":
                var rlc = moment(childSnapshot.val());                
                $('#farm-' + snapshot.key + '-rain_last_checked').text(rlc.fromNow());
                break;
            case "last_updated":
                var lu = moment(childSnapshot.val());
                $('#farm-' + snapshot.key + '-last_updated').text(lu.fromNow());         
                break;
            case "humidity_last_checked":
                var hlc = moment(childSnapshot.val());
                $('#farm-' + snapshot.key + '-humidity_last_checked').text(hlc.fromNow());         
                break;
            case "humidity_critical_point":
                $('#farm-' + snapshot.key + '-humidity_critical_point').text(childSnapshot.val());         
                break;*/
          }
        });     
      });

    });
  </script>

<!--Header-part-->
<div id="header">
  <h1><a href="/dashboard">SUT Smart Irrigation System Backend</a></h1>
</div>
<!--close-Header-part-->

<!--top-Header-menu-->
<div id="user-nav" class="navbar navbar-inverse">
  <ul class="nav">
    <li class="dropdown" id="profile-messages" ><a title="" href="#" data-toggle="dropdown" data-target="#profile-messages" class="dropdown-toggle"><i class="icon icon-user"></i>  <span class="text" id="user-email"></span><b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><a href="#"><i class="icon-user"></i> My Profile</a></li>
        <li class="divider"></li>
        <li><a href="#"><i class="icon-check"></i> My Tasks</a></li>
        <li class="divider"></li>
        <li><a href="login.html"><i class="icon-key"></i> Log Out</a></li>
      </ul>
    </li>
    <li class="dropdown" id="menu-messages"><a href="#" data-toggle="dropdown" data-target="#menu-messages" class="dropdown-toggle"><i class="icon icon-envelope"></i> <span class="text">Messages</span> <span class="label label-important">5</span> <b class="caret"></b></a>
      <ul class="dropdown-menu">
        <li><a class="sAdd" title="" href="#"><i class="icon-plus"></i> new message</a></li>
        <li class="divider"></li>
        <li><a class="sInbox" title="" href="#"><i class="icon-envelope"></i> inbox</a></li>
        <li class="divider"></li>
        <li><a class="sOutbox" title="" href="#"><i class="icon-arrow-up"></i> outbox</a></li>
        <li class="divider"></li>
        <li><a class="sTrash" title="" href="#"><i class="icon-trash"></i> trash</a></li>
      </ul>
    </li>
    <li class=""><a title="" href="#"><i class="icon icon-cog"></i> <span class="text">Settings</span></a></li>
    <li class=""><a title=""  href="javascript:UserAccount.UserSignOutOption()"><i class="icon icon-share-alt"></i> <span class="text">Logout</span></a></li>
  </ul>
</div>

<!--start-top-serch-->
<div id="search">
  <input type="text" placeholder="Search here..."/>
  <button type="submit" class="tip-bottom" title="Search"><i class="icon-search icon-white"></i></button>
</div>
<!--close-top-serch-->

<!--sidebar-menu-->

<div id="sidebar"> <a href="#" class="visible-phone"><i class="icon icon-list"></i></a>
  <ul>
    <li class="active"><a href="/dashboard"><i class="icon icon-home"></i> <span>Dashboard</span></a> </li>
    <li class="submenu"><a href="#"><i class="icon icon-leaf"></i></i> <span>รายการฟาร์ม</span><span class="label label-important">3</span></a>
      <ul>
        <li><a href="/farm">ฟาร์มทั้งหมด</a></li>
        <li><a href="/farm/1">&nbsp;&nbsp;- ฟาร์มเซ็นเซอร์</a></li>
        <li><a href="/farm/2">&nbsp;&nbsp;- ฟาร์ม ETp</a></li>
      </ul>
    </li>
    <li class="submenu"><a href="#"><i class="icon icon-wrench"></i> <span>จัดการฮาร์ดแวร์</span><span class="label label-important">3</span></a>
      <ul>
        <li><a href="mainpump">รายการปั๊มน้ำ</a></li>
        <li><a href="valve">รายการวาล์วเปิดปิดน้ำ</a></li>
        <li><a href="sensor">รายการเซ็นเซอร์</a></li>
      </ul>
    </li>
    <!--li> <a href="/valveschedule"><i class="icon icon-th"></i> <span>จัดการเปิดปิดวาล์วน้ำ</span></a> </li-->
    <li> <a href="/soil"><i class="icon icon-globe"></i> <span>จัดการประเภทดิน</span></a> </li>
    <li> <a href="/plant"><i class="icon icon-lemon"></i> <span>จัดการประเภทพืช</span></a> </li>
    <li> <a href="/user"><i class="icon icon-user"></i> <span>จัดการผู้ใช้งาน</span></a> </li>
  </ul>
</div>

<!--close-left-menu-stats-sidebar-->

<!--main-container-part-->
<div id="content">
<!--breadcrumbs-->
  <div id="content-header">
    <div id="breadcrumb"> <a href="/dashboard" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> Home</a></div>
  </div>
<!--End-breadcrumbs-->

<!--Action boxes-->
  <div class="container-fluid">
    <div class="quick-actions_homepage">
      <ul class="quick-actions">
        <!--li class="bg_lb"> <a href="/dashboard"> <i class="icon-dashboard"></i> <span class="label label-important">20</span> My Dashboard </a> </li-->
        <li class="bg_lb"> <a href="/dashboard"> <i class="icon-dashboard"></i> Backend Dashboard </a> </li>
        <li class="bg_lg span3"> <a href="/farm"> <i class="icon-leaf"></i> <span class="label label-important"><%= farms.length %> </span>รายการฟาร์มทั้งหมด</a> </li>
        <!--li class="bg_ly"> <a href="widgets.html"> <i class="icon-inbox"></i><span class="label label-success">101</span> Widgets </a> </li-->
        <li class="bg_lo"> <a href="/mainpump"> <i class="icon-cog"></i> จัดการปั๊มน้ำหลัก</a> </li>
        <li class="bg_ls"> <a href="/valve"> <i class="icon-tint"></i> จัดการวาล์วเปิดปิดน้ำ</a> </li>
        <li class="bg_lo span3"> <a href="/sensor"> <i class="icon-cogs"></i> จัดการเซ็นเซอร์</a> </li>
        <li class="bg_ls"> <a href="/soil"> <i class="icon-globe"></i> จัดการประเภทดิน</a> </li>
        <li class="bg_lb"> <a href="/plant"> <i class="icon-lemon"></i> จัดการประเภทพืช</a> </li>
        <li class="bg_lg"> <a href="/user"> <i class="icon-user"></i> จัดการบัญชีผู้ใช้</a> </li>
        <!--li class="bg_lr"> <a href="error404.html"> <i class="icon-info-sign"></i> Error</a> </li-->

      </ul>
    </div>
<!--End-Action boxes-->

<!--Chart-box-->
    <!--div class="row-fluid">
      <div class="widget-box">
        <div class="widget-title bg_lg"><span class="icon"><i class="icon-signal"></i></span>
          <h5>Site Analytics</h5>
        </div>
        <div class="widget-content" >
          <div class="row-fluid">
            <div class="span9">
              <div class="chart"></div>
            </div>
            <div class="span3">
              <ul class="site-stats">
                <li class="bg_lh"><i class="icon-user"></i> <strong>2540</strong> <small>Total Users</small></li>
                <li class="bg_lh"><i class="icon-plus"></i> <strong>120</strong> <small>New Users </small></li>
                <li class="bg_lh"><i class="icon-shopping-cart"></i> <strong>656</strong> <small>Total Shop</small></li>
                <li class="bg_lh"><i class="icon-tag"></i> <strong>9540</strong> <small>Total Orders</small></li>
                <li class="bg_lh"><i class="icon-repeat"></i> <strong>10</strong> <small>Pending Orders</small></li>
                <li class="bg_lh"><i class="icon-globe"></i> <strong>8540</strong> <small>Online Orders</small></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div-->
<!--End-Chart-box-->
    <!--hr/-->
    <div class="row-fluid">
      <div class="span6">
        <!--div class="widget-box">
          <div class="widget-title bg_ly" data-toggle="collapse" href="#collapseG2"><span class="icon"><i class="icon-chevron-down"></i></span>
            <h5>Latest Posts</h5>
          </div>
          <div class="widget-content nopadding collapse in" id="collapseG2">
            <ul class="recent-posts">
              <li>
                <div class="user-thumb"> <img width="40" height="40" alt="User" src="_img/demo/av1.jpg"> </div>
                <div class="article-post"> <span class="user-info"> By: john Deo / Date: 2 Aug 2012 / Time:09:27 AM </span>
                  <p><a href="#">This is a much longer one that will go on for a few lines.It has multiple paragraphs and is full of waffle to pad out the comment.</a> </p>
                </div>
              </li>
              <li>
                <div class="user-thumb"> <img width="40" height="40" alt="User" src="_img/demo/av2.jpg"> </div>
                <div class="article-post"> <span class="user-info"> By: john Deo / Date: 2 Aug 2012 / Time:09:27 AM </span>
                  <p><a href="#">This is a much longer one that will go on for a few lines.It has multiple paragraphs and is full of waffle to pad out the comment.</a> </p>
                </div>
              </li>
              <li>
                <div class="user-thumb"> <img width="40" height="40" alt="User" src="_img/demo/av4.jpg"> </div>
                <div class="article-post"> <span class="user-info"> By: john Deo / Date: 2 Aug 2012 / Time:09:27 AM </span>
                  <p><a href="#">This is a much longer one that will go on for a few lines.Itaffle to pad out the comment.</a> </p>
                </div>
              <li>
                <button class="btn btn-warning btn-mini">View All</button>
              </li>
            </ul>
          </div>
        </div-->
        <!--div class="widget-box">
          <div class="widget-title"> <span class="icon"><i class="icon-ok"></i></span>
            <h5>To Do list</h5>
          </div>
          <div class="widget-content">
            <div class="todo">
              <ul>
                <li class="clearfix">
                  <div class="txt"> Luanch This theme on Themeforest <span class="by label">Alex</span></div>
                  <div class="pull-right"> <a class="tip" href="#" title="Edit Task"><i class="icon-pencil"></i></a> <a class="tip" href="#" title="Delete"><i class="icon-remove"></i></a> </div>
                </li>
                <li class="clearfix">
                  <div class="txt"> Manage Pending Orders <span class="date badge badge-warning">Today</span> </div>
                  <div class="pull-right"> <a class="tip" href="#" title="Edit Task"><i class="icon-pencil"></i></a> <a class="tip" href="#" title="Delete"><i class="icon-remove"></i></a> </div>
                </li>
                <li class="clearfix">
                  <div class="txt"> MAke your desk clean <span class="by label">Admin</span></div>
                  <div class="pull-right"> <a class="tip" href="#" title="Edit Task"><i class="icon-pencil"></i></a> <a class="tip" href="#" title="Delete"><i class="icon-remove"></i></a> </div>
                </li>
                <li class="clearfix">
                  <div class="txt"> Today we celebrate the theme <span class="date badge badge-info">08.03.2013</span> </div>
                  <div class="pull-right"> <a class="tip" href="#" title="Edit Task"><i class="icon-pencil"></i></a> <a class="tip" href="#" title="Delete"><i class="icon-remove"></i></a> </div>
                </li>
                <li class="clearfix">
                  <div class="txt"> Manage all the orders <span class="date badge badge-important">12.03.2013</span> </div>
                  <div class="pull-right"> <a class="tip" href="#" title="Edit Task"><i class="icon-pencil"></i></a> <a class="tip" href="#" title="Delete"><i class="icon-remove"></i></a> </div>
                </li>
              </ul>
            </div>
          </div>
        </div-->
        <!--div class="widget-box">
          <div class="widget-title"> <span class="icon"><i class="icon-tint"></i></span>
            <h5>ความคืบหน้าการให้น้ำ</h5>
          </div>
          <div class="widget-content">
            <ul class="unstyled">
              <% for(var i=0;i < farms.length; i++){ %>
              <% if(farms[i].watering_scheme == '2') {
                      var complete_watering_day = 0;
                      for(var j=0;j < farms[i].watering_schedule.length; j++)
                      {
                        if(farms[i].watering_schedule[j].watering_complete)
                          complete_watering_day++;
                      }
                      var complete_watering_percent= (complete_watering_day*100/farms[i].watering_schedule.length).toFixed(2);
                %>
              <% if(complete_watering_percent > 60) { %>
              <li> <span class="icon24 icomoon-icon-arrow-up-2 green"></span><%= farms[i].title %>: ให้น้ำตามตารางได้สำเร็จ <%= complete_watering_day %> %<span class="pull-right strong">ต้องให้น้ำทั้งหมด <%= farms[i].watering_schedule.length %> วัน</span>
                <div class="progress progress-success progress-striped">
                  <div style="width: <%= complete_watering_day%>%;" class="bar"></div>
                </div>
              </li>
              <% } else if(complete_watering_percent > 30) { %>
                <li> <span class="icon24 icomoon-icon-arrow-up-2 green"></span><%= farms[i].title %>: ให้น้ำตามตารางได้สำเร็จ <%= complete_watering_day %> %<span class="pull-right strong">ต้องให้น้ำทั้งหมด <%= farms[i].watering_schedule.length %> วัน</span>
                  <div class="progress progress-warning progress-striped">
                    <div style="width: <%= complete_watering_day%>%;" class="bar"></div>
                  </div>
                </li>
                <% } else { %>
                  <li> <span class="icon24 icomoon-icon-arrow-up-2 green"></span><%= farms[i].title %>: ให้น้ำตามตารางได้สำเร็จ <%= complete_watering_day %> %<span class="pull-right strong">ต้องให้น้ำทั้งหมด <%= farms[i].watering_schedule.length %> วัน</span>
                    <div class="progress progress-danger progress-striped">
                      <div style="width: <%= complete_watering_day%>%;" class="bar"></div>
                    </div>
                  </li>
              <% } %>
              <% } %>
              <% } %>
              <li> <span class="icon24 icomoon-icon-arrow-up-2 green"></span> 72% Uniquie Clicks <span class="pull-right strong">507</span>
                <div class="progress progress-success progress-striped ">
                  <div style="width: 72%;" class="bar"></div>
                </div>
              </li>
              <li> <span class="icon24 icomoon-icon-arrow-down-2 red"></span> 53% Impressions <span class="pull-right strong">457</span>
                <div class="progress progress-warning progress-striped ">
                  <div style="width: 53%;" class="bar"></div>
                </div>
              </li>
              <li> <span class="icon24 icomoon-icon-arrow-up-2 green"></span> 3% Online Users <span class="pull-right strong">8</span>
                <div class="progress progress-danger progress-striped ">
                  <div style="width: 3%;" class="bar"></div>
                </div>
              </li>
            </ul>
          </div>
        </div-->
      <% for(var i=0;i < farms.length; i++) {
        if(farms[i].watering_scheme == '2') {
          var td = moment();
          var rain_last_checked = moment(farms[i].rain_last_checked);
          var last_activated_at_2 = moment(farms[i].last_activated_at);
          var last_updated_2 = moment(farms[i].last_updated); %>
          <div class="widget-box collapsible">
            <div class="widget-title"> <a data-toggle="collapse" href="#collapseOne<%= farms[i].id %>"> <span class="icon"><i class="icon-leaf"></i></span>
              <h5><%= farms[i].title %> <a href="/farm/show/<%= farms[i].id %>"><i class="icon-eye-open"></i></a></h5>
              </a> </div>
            <div id="collapseOne<%= farms[i].id %>" class="collapse in">
                <div class="widget-content nopadding">
                  <ul class="activity-list">
                    <li><a href="#"> <i class="icon-off"></i> <strong>สถานะเปิดใช้งาน</strong> <button id="button-farm-<%= farms[i].id %>-activate" class="btn btn-mini <% if(farms[i].activated == 'false') {%>btn-danger <% }else{ %> btn-success <% } %>"><% if(farms[i].activated == 'false') {%> <span class="icon-remove"></span> ปิด <% }else{ %><span class="icon-ok"></span> เปิด <% } %></button> <span id="farm-<%= farms[i].id %>-last_activated_at"><%= last_activated_at_2.fromNow() %></span> </a></li>
                    <% if(farms[i].activated == 'true') { %>
                    <li><a href="#"> <i class="icon-umbrella"></i> <strong>ปริมาณน้ำฝนล่าสุด</strong> <span id="farm-<%= farms[i].id %>-rain_last_read" style="font-style: normal; color:#666;"><%= farms[i].rain_last_read %></span> มม. <span id="farm-<%= farms[i].id %>-rain_last_checked"><%= rain_last_checked.fromNow() %></span> </a></li>
                    <% var td = moment().format("YYYY-MM-DD");
                       for(var j=0;j < farms[i].watering_schedule.length; j++) {
                         //console.log("diff days => " + moment(farms[i].watering_schedule[j].current_date).diff(td, 'days'));
                         if(moment(farms[i].watering_schedule[j].current_date).diff(td, 'days') == 0) {
                    %>
                    <% if(farms[i].watering_schedule[j].watering_complete) { %> 
                    <li><a href="#"> <i class="fas fa-smile" style="color:green;"></i> <strong>ตารางให้น้ำวันนี้</strong> <%= farms[i].watering_schedule[j].hours %> ชม. <%= farms[i].watering_schedule[j].mins %> นาที <span class="date badge badge-success">ให้น้ำเรียบร้อย</span></a></li>
                    <% } else { %>
                      <li><a href="#"> <i class="fas fa-frown-open blink-icon"></i> <strong>ตารางให้น้ำวันนี้</strong> <%= farms[i].watering_schedule[j].hours %> ชม. <%= farms[i].watering_schedule[j].mins %> นาที <span class="date badge badge-important">Today</span></a></li>
                    <% } %>
                    <% }else if(moment(farms[i].watering_schedule[j].current_date).diff(td, 'days') == 1){ %>
                      <li><a href="#"> <i class="icon-check"></i> <strong>ตารางให้น้ำครั้งต่อไป</strong> <span class="date badge badge-warning">Tomorrow</span></a></li>
                    <% break;
                        }else if(moment(farms[i].watering_schedule[j].current_date).diff(td, 'days') > 1){  %>
                      <li><a href="#"> <i class="icon-check"></i> <strong>ตารางให้น้ำครั้งต่อไป</strong> <span class="date badge badge-info"><%= moment(farms[i].watering_schedule[j].current_date).format('DD MMM YYYY') %></span></a></li>    
                    <% break;
                        } %>
                    <% } %>
                  <li><a href="#"> <i class="icon-time"></i> <strong>อัพเดตข้อมูลล่าสุด</strong> <span id="farm-<%= farms[i].id %>-last_updated"><%= last_updated_2.fromNow() %></span></a></li>
                  <% } %>
                  </ul>
                </div>
            </div>
            <div class="widget-title"> <a data-toggle="collapse" href="#collapseTwo<%= farms[i].id %>"> <span class="icon"><i class="icon-calendar"></i></span>
              <h5>ตารางการให้น้ำ<%= farms[i].title %> ครั้งต่อไป</h5>
              </a> </div>
            <div id="collapseTwo<%= farms[i].id %>" class="collapse">
              <div class="widget-content">
                <% for(var j=0;j < farms[i].watering_schedule.length; j++) {
                     if(moment(farms[i].watering_schedule[j].current_date).isSameOrAfter()) {
                %>
                <div class="new-update clearfix"><i class="icon-tint"></i>
                  <div class="update-done"><a title="" href="#"><strong>ต้องให้น้ำเป็นเวลา <%= farms[i].watering_schedule[j].hours %> ชม. <%= farms[i].watering_schedule[j].mins %> นาที</strong></a> <span>จำนวนวันที่ต้องให้น้ำครั้งต่อไป <%= farms[i].watering_schedule[j].days %> วัน</span> </div>
                  <div class="update-date"><span class="update-day"><%= moment(farms[i].watering_schedule[j].current_date, 'YYYY-MM-DD').date() %></span><%= moment(farms[i].watering_schedule[j].current_date, 'YYYY-MM-DD').format('MMM') %></div>
                </div>
                <% }
                } %>
              </div>
            </div>
            <div class="widget-title"> <a data-toggle="collapse" href="#collapseThree<%= farms[i].id %>"> <span class="icon"><i class="icon-calendar"></i></span>
              <h5>ตารางการให้น้ำ<%= farms[i].title %> ทั้งหมด</h5>
              </a> </div>
            <div id="collapseThree<%= farms[i].id %>" class="collapse">
              <div class="widget-content">
                <% for(var j=0;j < farms[i].watering_schedule.length; j++) {
                  var td = moment();
                  %>
                <div class="new-update clearfix"><i class="icon-tint"></i>
                  <div class="update-done"><a title="" href="#"><strong>ต้องให้น้ำเป็นเวลา <%= farms[i].watering_schedule[j].hours %> ชม. <%= farms[i].watering_schedule[j].mins %> นาที</strong></a> <span>จำนวนวันที่ต้องให้น้ำครั้งต่อไป <%= farms[i].watering_schedule[j].days %> วัน</span> </div>
                  <div class="update-date"><span class="update-day"><%= moment(farms[i].watering_schedule[j].current_date, 'YYYY-MM-DD').date() %></span><%= moment(farms[i].watering_schedule[j].current_date, 'YYYY-MM-DD').format('MMM') %></div>
                </div>
                <% } %>
              </div>
            </div>
          </div>
      <% }
    } %>
      </div>

      <div class="span6">
        <!--div class="widget-box widget-chat">
          <div class="widget-title bg_lb"> <span class="icon"> <i class="icon-comment"></i> </span>
            <h5>Chat Option</h5>
          </div>
          <div class="widget-content nopadding collapse in" id="collapseG4">
            <div class="chat-users panel-right2">
              <div class="panel-title">
                <h5>Online Users</h5>
              </div>
              <div class="panel-content nopadding">
                <ul class="contact-list">
                  <li id="user-Alex" class="online"><a href=""><img alt="" src="_img/demo/av1.jpg" /> <span>Alex</span></a></li>
                  <li id="user-Linda"><a href=""><img alt="" src="_img/demo/av2.jpg" /> <span>Linda</span></a></li>
                  <li id="user-John" class="online new"><a href=""><img alt="" src="_img/demo/av3.jpg" /> <span>John</span></a><span class="msg-count badge badge-info">3</span></li>
                  <li id="user-Mark" class="online"><a href=""><img alt="" src="_img/demo/av4.jpg" /> <span>Mark</span></a></li>
                  <li id="user-Maxi" class="online"><a href=""><img alt="" src="_img/demo/av5.jpg" /> <span>Maxi</span></a></li>
                </ul>
              </div>
            </div>
            <div class="chat-content panel-left2">
              <div class="chat-messages" id="chat-messages">
                <div id="chat-messages-inner"></div>
              </div>
              <div class="chat-message well">
                <button class="btn btn-success">Send</button>
                <span class="input-box">
                <input type="text" name="msg-box" id="msg-box" />
                </span> </div>
            </div>
          </div>
        </div-->
        <!--div class="widget-box">
          <div class="widget-title"><span class="icon"><i class="icon-user"></i></span>
            <h5>Our Partner (Box with Fix height)</h5>
          </div>
          <div class="widget-content nopadding fix_hgt">
            <ul class="recent-posts">
              <li>
                <div class="user-thumb"> <img width="40" height="40" alt="User" src="_img/demo/av1.jpg"> </div>
                <div class="article-post"> <span class="user-info">John Deo</span>
                  <p>Web Desginer &amp; creative Front end developer</p>
                </div>
              </li>
              <li>
                <div class="user-thumb"> <img width="40" height="40" alt="User" src="_img/demo/av2.jpg"> </div>
                <div class="article-post"> <span class="user-info">John Deo</span>
                  <p>Web Desginer &amp; creative Front end developer</p>
                </div>
              </li>
              <li>
                <div class="user-thumb"> <img width="40" height="40" alt="User" src="_img/demo/av4.jpg"> </div>
                <div class="article-post"> <span class="user-info">John Deo</span>
                  <p>Web Desginer &amp; creative Front end developer</p>
                </div>
            </ul>
          </div>
        </div-->
        <!--div class="accordion" id="collapse-group">
          <div class="accordion-group widget-box">
            <div class="accordion-heading">
              <div class="widget-title"> <a data-parent="#collapse-group" href="#collapseGOne" data-toggle="collapse"> <span class="icon"><i class="icon-magnet"></i></span>
                <h5>Accordion Example 1</h5>
                </a> </div>
            </div>
            <div class="collapse in accordion-body" id="collapseGOne">
              <div class="widget-content"> It has multiple paragraphs and is full of waffle to pad out the comment. Usually, you just wish these sorts of comments would come to an end. </div>
            </div>
          </div>
          <div class="accordion-group widget-box">
            <div class="accordion-heading">
              <div class="widget-title"> <a data-parent="#collapse-group" href="#collapseGTwo" data-toggle="collapse"> <span class="icon"><i class="icon-magnet"></i></span>
                <h5>Accordion Example 2</h5>
                </a> </div>
            </div>
            <div class="collapse accordion-body" id="collapseGTwo">
              <div class="widget-content">And is full of waffle to It has multiple paragraphs and is full of waffle to pad out the comment. Usually, you just wish these sorts of comments would come to an end.</div>
            </div>
          </div>
          <div class="accordion-group widget-box">
            <div class="accordion-heading">
              <div class="widget-title"> <a data-parent="#collapse-group" href="#collapseGThree" data-toggle="collapse"> <span class="icon"><i class="icon-magnet"></i></span>
                <h5>Accordion Example 3</h5>
                </a> </div>
            </div>
            <div class="collapse accordion-body" id="collapseGThree">
              <div class="widget-content"> Waffle to It has multiple paragraphs and is full of waffle to pad out the comment. Usually, you just </div>
            </div>
          </div>
        </div-->
        <% for(var i=0; i < farms.length; i++) {
          if(farms[i].watering_scheme == '1') {
            var td = moment();
            var humidity_last_checked = moment(farms[i].humidity_last_checked);
            var last_activated_at_1 = moment(farms[i].last_activated_at);
            var last_updated_1 = moment(farms[i].last_updated);
            %>
        <div class="widget-box collapsible">
          <div class="widget-title"> <a data-toggle="collapse" href="#collapse<%= farms[i].id %>"> <span class="icon"><i class="icon-leaf"></i></span>
            <h5><%= farms[i].title %> <a href="/farm/show/<%= farms[i].id %>"><i class="icon-eye-open"></i></a></h5>
            </a> </div>
          <div id="collapse<%= farms[i].id %>" class="collapse in">
              <div class="widget-content nopadding">
                <ul class="activity-list">
                  <li><a href="#"> <i class="icon-off"></i> <strong>สถานะเปิดใช้งาน</strong> <button id="button-farm-<%= farms[i].id %>-activate" class="btn btn-mini <% if(farms[i].activated == 'false') {%>btn-danger <% }else{ %> btn-success <% } %>"><% if(farms[i].activated == 'false') {%> <span class="icon-remove"></span> ปิด <% }else{ %><span class="icon-ok"></span> เปิด <% } %></button> <span id="farm-<%= farms[i].id %>-last_activated_at"><%= last_activated_at_1.fromNow() %></span> </a></li>
                  <% if(farms[i].activated == 'true') { %>
                  <li><a href="#"> <i class="icon-warning-sign"></i> <strong>ค่าจุดวิกฤตความชื้น</strong> <span id="farm-<%= farms[i].id %>-humidity_critical_point" style="font-style: normal; color:#666;"><%= farms[i].humidity_critical_point %></span>% </a></li>                  
                  <% if(farms[i].humidity_last_read < farms[i].humidity_critical_point) { %>
                    <li><a href="#"> <i class="fas fa-frown-open blink-icon"></i> <strong>ค่าความชื้นล่าสุด</strong> <span id="farm-<%= farms[i].id %>-humidity_last_read" style="font-style: normal; color:#666;"><%= farms[i].humidity_last_read %></span>% < จุดวิกฤตความชื้น <span id="farm-<%= farms[i].id %>-humidity_last_checked"><%= humidity_last_checked.fromNow() %></span> </a></li>
                  <% } else { %>
                    <li><a href="#"> <i class="fas fa-smile" style="color:green;"></i> <strong>ค่าความชื้นล่าสุด</strong> <span id="farm-<%= farms[i].id %>-humidity_last_read" style="font-style: normal; color:#666;"><%= farms[i].humidity_last_read %></span>% <span id="farm-<%= farms[i].id %>-humidity_last_checked"><%= humidity_last_checked.fromNow() %></span> </a></li>
                  <% } %>
                  <li><a href="#"> <i class="icon-time"></i> <strong>อัพเดตข้อมูลล่าสุด</strong> <span id="farm-<%= farms[i].id %>-last_updated"><%= last_updated_1.fromNow() %></span></a></li>
                  <% } %>
                </ul>
              </div>
          </div>
        </div>

          <!--div class="widget-title"> <a data-toggle="collapse" href="#collapseTwo"> <span class="icon"><i class="icon-remove"></i></span>
            <h5>Toggle, closed by default</h5>
            </a> </div>
          <div id="collapseTwo" class="collapse">
            <div class="widget-content"> This box is now open </div>
          </div>
          <div class="widget-title"> <a data-toggle="collapse" href="#collapseThree"> <span class="icon"><i class="icon-remove"></i></span>
            <h5>Toggle, closed by default</h5>
            </a> </div>
          <div id="collapseThree" class="collapse">
            <div class="widget-content"> This box is now open </div>
          </div-->
      <% }
    } %>
        <!--div class="widget-box">
          <div class="widget-title">
            <ul class="nav nav-tabs">
              <li class="active"><a data-toggle="tab" href="#tab1">Tab1</a></li>
              <li><a data-toggle="tab" href="#tab2">Tab2</a></li>
              <li><a data-toggle="tab" href="#tab3">Tab3</a></li>
            </ul>
          </div>
          <div class="widget-content tab-content">
            <div id="tab1" class="tab-pane active">
              <p>And is full of waffle to It has multiple paragraphs and is full of waffle to pad out the comment. Usually, you just wish these sorts of comments would come to an end.multiple paragraphs and is full of waffle to pad out the comment.</p>
              <img src="_img/demo/demo-image1.jpg" alt="demo-image"/></div>
            <div id="tab2" class="tab-pane"> <img src="_img/demo/demo-image2.jpg" alt="demo-image"/>
              <p>And is full of waffle to It has multiple paragraphs and is full of waffle to pad out the comment. Usually, you just wish these sorts of comments would come to an end.multiple paragraphs and is full of waffle to pad out the comment.</p>
            </div>
            <div id="tab3" class="tab-pane">
              <p>And is full of waffle to It has multiple paragraphs and is full of waffle to pad out the comment. Usually, you just wish these sorts of comments would come to an end.multiple paragraphs and is full of waffle to pad out the comment. </p>
              <img src="_img/demo/demo-image3.jpg" alt="demo-image"/></div>
          </div>
        </div-->
      </div>
    </div>
  </div>
</div>

<!--end-main-container-part-->

<!--Footer-part-->

<div class="row-fluid">
  <div id="footer" class="span12"> 2013 &copy; Matrix Admin. Brought to you by <a href="http://themedesigner.in">Themedesigner.in</a> </div>
</div>

<!--end-Footer-part-->
<script src="/_js/excanvas.min.js"></script>
<script src="/_js/jquery.min.js"></script>
<script src="/_js/jquery.ui.custom.js"></script>
<script src="/_js/bootstrap.min.js"></script>
<script src="/_js/jquery.flot.min.js"></script>
<script src="/_js/jquery.flot.resize.min.js"></script>
<script src="/_js/jquery.peity.min.js"></script>
<script src="/_js/fullcalendar.min.js"></script>
<script src="/_js/matrix.js"></script>
<script src="/_js/matrix.dashboard.js"></script>
<script src="/_js/jquery.gritter.min.js"></script>
<script src="/_js/matrix.interface.js"></script>
<script src="/_js/matrix.chat.js"></script>
<script src="/_js/jquery.validate.js"></script>
<script src="/_js/matrix.form_validation.js"></script>
<script src="/_js/jquery.wizard.js"></script>
<script src="/_js/jquery.uniform.js"></script>
<script src="/_js/select2.min.js"></script>
<script src="/_js/matrix.popover.js"></script>
<script src="/_js/jquery.dataTables.min.js"></script>
<script src="/_js/matrix.tables.js"></script>
<script type="text/javascript">
  // This function is called from the pop-up menus to transfer to
  // a different page. Ignore if the value returned is a null string:
  function goPage (newURL) {

      // if url is empty, skip the menu dividers and reset the menu selection to default
      if (newURL != "") {

          // if url is "-", it is this page -- reset the menu:
          if (newURL == "-" ) {
              resetMenu();
          }
          // else, send page to designated URL
          else {
            document.location.href = newURL;
          }
      }
  }

// resets the menu selection upon entry to this page:
function resetMenu() {
   document.gomenu.selector.selectedIndex = 2;
}
</script>
</body>
</html>
